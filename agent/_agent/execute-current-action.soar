# When there is a top-state.current-action <a>
#   Propose code to execute that action
#   Requires an execution-operator <name> on the current-action
# Specific execution operators are under the action folder (e.g. execute-pick-up)
                                                           
sp {top-state*elaborate*current-action*segment
   (state <s> ^top-state <s>
              ^interaction.stack.segment.current-action <a>)
-->
   (<s> ^current-action <a>)
}

sp {top-state*propose*execute*current-action
   (state <s> ^top-state <s>
              ^current-action <a>)
   (<a> ^execution-operator <op-name>)
-->
   (<s> ^operator <o> +)
   (<o> ^name <op-name>
        ^action-phase execution)
}

sp {top-state*elaborate*execute*current-action*arguments
   (state <s> ^top-state <s>
              ^current-action <a>
              ^operator <o> +)
   (<a> ^arguments.<arg-name> <arg>)
-->
   (<o> ^<arg-name> <arg>)
}

#
#sp {top-state*elaborate*execute-operator*termination-condition*stabilized*driving
#   (state <s> ^top-state <s>
#              ^current-action <a>
#              ^operator <o> +)
#   (<o> ^action-name << drive-forward1 follow-left-wall1 follow-right-wall1 >>
#        ^action-phase execution
#       -^until)
#-->
#   (<o> ^termination-condition <term>)
#   (<term> ^name stabilized)
#}
#
#sp {top-state*elaborate*execute-operator*termination-condition*object-count
#   (state <s> ^top-state <s>
#              ^current-action <a>
#              ^operator <o> +)
#   (<o> ^action-phase execution
#        ^until <until>)
#   (<until> ^object-type <type>
#            ^object-count <count>)
#-->
#   (<o> ^termination-condition <term>)
#   (<term> ^name count
#           ^parameters <params>)
#   (<params> ^count <count>
#             ^class <type>)
#}
#
#sp {top-state*elaborate*execute-operator*termination-condition*timeout
#   (state <s> ^top-state <s>
#              ^current-action <a>
#              ^operator <o> +)
#   (<o> ^action-phase execution
#        ^until.timeout <t>)
#-->
#   (<o> ^termination-condition <term>)
#   (<term> ^name timeout
#           ^parameters <params>)
#   (<params> ^timeout <t>)
#}
##
##sp {top-state*elaborate*execute-operator*termination-condition*object-detection
##   (state <s> ^top-state <s>
##              ^current-action <a>
##              ^operator <o> +)
##   (<o> ^action-phase execution
##        ^until <until>)
##   (<until> ^object-type <type>
##            ^object-count <count>)
##-->
##   (<o> ^termination-condition <term>)
##   (<term> ^name count
##           ^parameters <params>)
##   (<params> ^count <count>
##             ^class <type>)
##}

sp {top-state*apply*action*execution*complete*remove*current-action
   (state <s> ^top-state <s>
              ^operator <o>
              ^interaction.stack.segment <seg>)
   (<o> ^action-phase execution)
   (<seg> ^current-action <a>)
   (<a> ^status complete)
-->
   (<seg> ^current-action <a> -)
}

sp {top-state*apply*action*execution*complete*copy*next-action
   (state <s> ^top-state <s>
              ^operator <o>
              ^interaction.stack.segment <seg>)
   (<o> ^action-phase execution)
   (<seg> ^current-action.next-action { <next> <> none })
-->
   (<seg> ^current-action <next>)
}

sp {top-state*apply*action*execution*complete*report*performed*action-event
   (state <s> ^top-state <s>
              ^operator <o>
              ^current-action <a>
              ^interaction.status <status>)
   (<o> ^action-phase execution)
   (<a> ^name <name>
        ^status complete)
-->
   (<status> ^performed.action-event.type <name>)
}