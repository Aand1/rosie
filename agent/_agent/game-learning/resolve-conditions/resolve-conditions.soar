sp {all-states*elaborate*linkstate
   (state <s> ^superstate <ts>)
   (<ts> ^linkstate <ss>)
-->
   (<s> ^linkstate <ss>)
}

sp {resolve-conditions*elaborate*type
   (state <s> ^name resolve-conditions)
-->
   (<s> ^type action goal failure)
}
#learn conditions of predicates if unchunked
sp {resolve-conditions*elaborate*nlp-set
   (state <s> ^name resolve-conditions
             ^linkstate <ts>)
   (<ts> ^<type>.condition <c> ^gtype <type>)
-->
   (<s> ^condition <c>)
}

#TODO chunk this?? could be over specific, but otherwise could be slow
#if move down to resolve-conditions, easy to chunk
#sp {resolve-conditions*propose*retrieve-predicate-structure
#   (state <s> ^name learn-predicate)#resolve-conditions
#              #^linkstate <ls>)
#   (<s> ^gtype <gtype>
#       -^predicate.link <co>
#         ^<gtype>.condition <co>)
#   (<co> ^type concept ^attribute predicate ^name <name>)
#-->
#   (<s> ^operator <o> + =)
#   (<o> ^name retrieve-predicate-structure
#        ^condition <co>
#        ^predicate-handle <name>)
#}

sp {resolve-conditions*propose*retrieve-predicate-structure
   (state <s> ^name learn-predicate)
   (<s> ^gtype <gtype>
       -^predicate.link <co>
         ^<gtype> <g>)
   (<g> ^condition <co>)
   (<co> ^type concept ^attribute predicate ^name <name>)
-->
   (<s> ^operator <o> + =)
   (<o> ^name chunk-predicate-structure
        ^<gtype>.condition <co>
        ^gtype <gtype>)
}

#sp {resolve-conditions*reject*retrieve-predicate-structure
#   (state <s> ^name resolve-conditions
#              ^operator <o> +
#              ^linkstate <ls>)
#   (<ls> ^gtype <gtype>
#          ^predicate.link <co>
#         ^<gtype>.condition <co>)
#   (<co> ^type concept ^attribute predicate ^name <name>)
#   (<o> ^name retrieve-predicate-structure
#        ^condition <co>
#        ^predicate-handle <name>)
#-->
#   (<s> ^operator <o> -)
#}

#sp {topstate*elaborate*clearsdfsdf
#   (state <s> ^name learn-predicate
#              ^gtype <gtype>
#              ^<gtype>.condition <co>)
#   (<co> ^type concept ^attribute predicate ^name clear)
#-->
#    (<s> ^predicate <T5> ^gtype predicate)
#   
#   (<T5> ^nlp-set <nlps> ^formated predicate ^parameter-set <P124> ^potential-args <P125> ^link <co>)
#(<P124> ^argnum 1)
#
###action stack
#  (<nlps> ^nlp <cs> ^aname clear)
#
#   
#   (<cs> ^result <r4> ^name below1 ^parameter <param1> ^rtype single ^negative true ^args <ag> ^type state-pair ^attribute prepositions)
#   (<r4> ^set <res4>)
#   (<ag> ^1 <c5> ^2 <c6> ^num 2)
#   (<param1> ^1 <p11> ^num 1)
#   (<p11> ^param-id 1 ^type single)     
#   
#    (<c5> ^args <A57> ^attribute input-arg ^name object ^negative false 
#                 ^parameter <P225> ^rtype single)
#   (<P225> ^1 <P224> ^num 1)
#   (<P224> ^param-id 1 ^type single)
#   
#   (<c6> ^args <A56> ^attribute primitive ^name object ^negative false
#                 ^parameter <P226> ^result <R96> ^rtype single ^type attribute)
#            (<P226> ^num 0)
#            (<R96> ^set <S156>)
# 
#}

#todo remove this rule
sp {resolve-conditions*elaborate*parameter-set
   (state <s> ^name resolve-conditions
              ^type <type>
             ^linkstate <ts>)
   (<ts> ^<type> <t2>
         ^gtype <type>)
   (<t2> ^parameter-set <ps>
         ^potential-args <po>)
-->
   (<s> ^parameter-set <ps>
        ^potential-args <po>)
}

#try to evaluate conditions whose arguments have been determined
sp {resolve-conditions*propose*learn-condition
   (state <s> ^name resolve-conditions
              #^linkstate.ewave <e>
              ^condition <co>)
  # (<co> ^ewave <= <e>)  #doubles have both ewave no bad only test on final copy
-->
   (<s> ^operator <o> + =)
   (<o> ^name learn-condition
        ^condition <co>)
}
sp {resolve-conditions*prefer*retrieve-predicate-structure*overlearn-condition
   (state <s> ^name resolve-conditions
              ^operator <o2> +
              ^operator <o> +)
   (<o> ^name learn-condition)
   (<o2> ^name retrieve-predicate-structure)
-->
   (<s> ^operator <o2> > <o>)
}

sp {resolve-conditions*disprefer*concepts
   (state <s> ^name resolve-conditions
              ^operator <o> +)
   (<o> ^name learn-condition
        ^condition <co>)
   (<co> ^type concept)
-->
   (<s> ^operator <o> <)
}
sp {resolve-conditions*disprefer*input-args
   (state <s> ^name resolve-conditions
              ^operator <o> +)
   (<o> ^name learn-condition
        ^condition <co>)
   (<co> ^attribute input-arg)
-->
   (<s> ^operator <o> <)
}

sp {resolve-conditions*prefer*learn-condition*childresults
   (state <s> ^name resolve-conditions
              ^operator <o> +)
   (<o> ^name learn-condition
        ^condition <co>)
   (<co> ^args.<< 1 2 3 4 5 6 7 8 9 10 >> <c1>)
   (<c1> -^result.set.instance.{1})
-->
   (<s> ^operator <o> <)
}
sp {resolve-conditions*prefer*learn-condition*childresults-under
   (state <s> ^name resolve-conditions
              ^operator <o> +)
   (<o> ^name learn-condition
        ^condition <co>)
   (<co> ^args.<< 1 2 3 4 5 6 7 8 9 10 >> <c1>)
   (<c1> -^result.set.instance.{1}.<something> -^return-type number)
-->
   (<s> ^operator <o> <)
}
sp {resolve-conditions*prefer*learn-condition*reject-complete
   (state <s> ^name resolve-conditions
              ^linkstate <ls>
              ^operator <o> +)
   (<o> ^name learn-condition
        ^condition <co>)
   (<co> ^result.set.instance.{1} <a>)
  -{(state <ls>)
    (<a> -^<something>)}
-->
   (<s> ^operator <o> -)
}
#TODO fix number issue
sp {resolve-conditions*prefer*learn-condition*reject-complete*number
   (state <s> ^name resolve-conditions
              ^operator <o> +)
   (<o> ^name learn-condition
        ^condition <co>)
   (<co> ^result.set.instance.{1} <something> ^return-type number)
-->
   (<s> ^operator <o> -)
}

#sp {resolve-conditions*propose*eval-parameters
#   (state <s> ^name resolve-conditions
#              #^linkstate.gtype action
#              ^potential-args <po>
#              ^parameter-set <ps>)
#-->
#   (<s> ^operator <o> + =)
#   (<o> ^name eval-parameters
#        ^potential-args <po>
#        ^parameter-set <ps>)
#}
#
#sp {resolve-conditions*prefer*learn-condition*over*eval-parameters
#   (state <s> ^name resolve-conditions
#              ^operator <o1> +
#              ^operator <o2> +)
#   (<o1> ^name learn-condition)
#   (<o2> ^name eval-parameters)
#-->
#   (<s> ^operator <o1> > <o2>)
#}
