##Move a clear block onto a clear object.
#sp {convert-parsed-format*elaborate*sentence
#   (state <s> ^name convert-parsed-format)
#-->
#   (<s> ^sentence <S114>)
#(<S114> ^action <A1008> ^arg1 <P90086> ^arg2 <S373> ^message-type command)
#  (<A1008> ^handle move1 ^item-type action)
#  (<P90086> ^handle new-object-id1 ^item-type object ^predicates <P90087>
#         ^predicates-copied true)
#    (<P90087> ^category block1 ^dialog-object true ^property clear)
#  (<S373> ^2 <P90131> ^handle on1 ^item-type predicate)
#    (<P90131> ^handle new-object-id2 ^item-type object ^predicates <P90132>
#           ^predicates-copied true ^relations <S367>)
#      (<P90132> ^category object ^dialog-object true ^property clear)
#      (<S367> ^2 <P90086> ^handle larger-than1) 
##   (<s> ^sentence <S111>)
##(<S111> ^action <A1008> ^arg1 <P90101>
##       ^arg2 <S267> ^message-type command)
##  (<A1008> ^handle move1 ^item-type action)
##  (<P90101> ^handle new-object-id2 ^item-type object ^predicates <P90102>
##         ^predicates-copied true)
##    (<P90102> ^category block1 ^dialog-object true ^property clear)
##  (<S267> ^2 <P90093> ^handle on1 ^item-type predicate)
##    (<P90093> ^handle new-object-id1 ^item-type object ^predicates <P90094>
##           ^predicates-copied true)
##      (<P90094> ^category object ^dialog-object true ^property clear)
##
##   (<s> ^sentence <S298>)
##(<S298> ^arg1 <P90101>
##       ^message-type object-description ^predicate <S454>)
##  (<P90101> ^handle new-object-id2 ^item-type object ^predicates <P90102>
##         ^predicates-copied true)
##    (<P90102> ^category block1 ^dialog-object true ^property clear)
##  (<S454> ^2 <P90093> ^handle smaller-than1 ^item-type predicate)
##    (<P90093> ^handle new-object-id1 ^item-type object ^predicates <P90094>
##           ^predicates-copied true)
##      (<P90094> ^category object ^dialog-object true ^property clear)
#}
##The block is smaller than the object.
#The goal is that a large block is on a blue location and a medium block is on the large block and a small block is on the medium block.
#sp {convert-parsed-format*elaborate*sentence
#   (state <s> ^name convert-parsed-format)
#-->
#   (<s> ^sentence <S114>)
#(<S114> ^arg1 <G5> ^message-type object-description ^subclause <S188>)
#  (<G5> ^handle goal1 ^property <C21>)
#    (<C21> ^handle concept ^type conceptual)
#  (<S188> ^subclause <S417> ^subclause <S767>)
#    (<S417> ^subclause <S538> ^subclause <S313>)
#      (<S538> ^arg1 <P90120> ^predicate <S633>)
#        (<P90120> ^handle new-object-id3 ^item-type object ^predicates <P90121>
#               ^predicates-copied true)
#          (<P90121> ^category block1 ^dialog-object true ^size medium1)
#        (<S633> ^2 <P90087> ^handle on1 ^item-type predicate)
#      (<S313> ^arg1 <P90087> ^predicate <S404>)
#        (<P90087> ^handle new-object-id1 ^item-type object ^predicates <P90088>
#               ^predicates-copied true)
#          (<P90088> ^category block1 ^dialog-object true ^size large1)
#        (<S404> ^2 <P90106> ^handle on1 ^item-type predicate)
#          (<P90106> ^handle new-object-id2 ^item-type object ^predicates <P90107>
#                 ^predicates-copied true)
#            (<P90107> ^category location1 ^color blue1 ^dialog-object true)
#    (<S767> ^arg1 <P90175> ^predicate <S862>)
#      (<P90175> ^handle new-object-id4 ^item-type object ^predicates <P90176>
#             ^predicates-copied true)
#        (<P90176> ^category block1 ^dialog-object true ^size small1)
#      (<S862> ^2 <P90120> ^handle on1 ^item-type predicate)
#}
#Move a free red block onto a clear location.
#sp {convert-parsed-format*elaborate*sentence
#   (state <s> ^name convert-parsed-format)
#-->
#   (<s> ^sentence <S114>)
#   (<S114> ^action <A1008> ^arg1 <P90128> ^arg2 <S648> ^message-type command)
#  (<A1008> ^handle move1 ^item-type action)
#  (<P90128> ^handle new-object-id3 ^item-type object ^predicates <P90129> ^predicates-copied true)
#    (<P90129> ^category block1 ^color red1 ^dialog-object true ^property free)
#  (<S648> ^2 <P90138> ^handle on1 ^item-type predicate)
#    (<P90138> ^handle new-object-id4 ^item-type object ^predicates <P90139> ^predicates-copied true)
#      (<P90139> ^category location1 ^dialog-object true ^property clear)
#}
# (added plural flag
#The goal is that three captured locations are linear.
#sp {convert-parsed-format*elaborate*sentence
#   (state <s> ^name convert-parsed-format)
#-->
#   (<s> ^sentence <S114>)
#	(<S114> ^arg1 <G5> ^message-type object-description ^subclause <S749>)
#  (<G5> ^handle goal1 ^property <C23>)
#    (<C23> ^handle concept ^type conceptual)
#  (<S749> ^arg1 <P90177> ^predicate <L4>)
#    (<P90177> ^handle new-object-id5 ^item-type object ^predicates <P90178> ^predicates-copied true)
#      (<P90178> ^category location ^category object ^dialog-object true ^plural true ^number 3 ^property captured ^visible false)
#    (<L4> ^handle linear ^item-type predicate ^property <C12>)
#      (<C12> ^handle property ^type visual)
#}
##The name of the game is tic-tac-toe.
#sp {convert-parsed-format*elaborate*sentence
#   (state <s> ^name convert-parsed-format)
#-->
#   (<s> ^sentence <S114>)
#(<S114> ^arg1 <S237> ^message-type object-description ^predicate <R10165>)
#  (<S237> ^2 <S238> ^handle of1 ^item-type predicate)
#    (<S238> ^2 <G2> ^handle name1)
#      (<G2> ^handle game1 ^property <C23>)
#        (<C23> ^handle concept ^type conceptual)
#  (<R10165> ^handle tic-tac-toe1 ^item-type predicate ^word-structure <N10053>)
#    (<N10053> ^referent <R10165> ^spelling tic-tac-toe)
#}
##The name of an action is place-block.
#sp {convert-parsed-format*elaborate*sentence
#   (state <s> ^name convert-parsed-format)
#-->
#   (<s> ^sentence <S114>)
#(<S144> ^arg1 <S413> ^message-type object-description ^predicate <R10286>)
#  (<S413> ^2 <S414> ^handle of1 ^item-type predicate)
#    (<S414> ^2 <A10025> ^handle name1)
#      (<A10025> ^handle action ^property <C23>)
#        (<C23> ^handle concept ^type conceptual)
#  (<R10286> ^handle place-block2 ^item-type predicate ^word-structure <N10092>)
#    (<N10092> ^referent <R10286> ^spelling place-block) 
#}


sp {convert-parsed-format*elaborate*sentence
   (state <s> ^name convert-parsed-format
              ^superstate.operator <sop>)
   (<sop> ^structure <t>)
-->
   (<s> ^sentence <t>)
}



#todo teach concept linear on set
#need one of operator
#make to handle action with move


sp {convert-parsed-format*elaborate*object-count
   (state <s> ^name convert-parsed-format)
-->
   (<s> ^object-count 1
        ^nlp-set <nps>)
}

sp {convert-parsed-format*elaborate*sentence*subclause
   (state <s> ^name convert-parsed-format
              ^sentence <s2>)
-->
   (<s> ^clause <s2>)
}
sp {convert-parsed-format*elaborate*clause*subclause
   (state <s> ^name convert-parsed-format
              ^clause <c>)
   (<c> ^<< if-subclause subclause then-subclause >> <s1>)
-->
   (<s> ^clause <s1>)
}
#sp {convert-parsed-format*elaborate*arg1*parameter*from*sentence
#   (state <s> ^name convert-parsed-format
#              ^sentence <c>)
#   (<c> ^<< arg1 arg2 >> <p>)
#   (<p> ^item-type object)
#-->
#   (<s> ^parameter <p>)
#}

sp {convert-parsed-format*elaborate*arg1*parameter
   (state <s> ^name convert-parsed-format
              ^clause <c>)
   (<c> ^<< arg1 arg2 >> <p>)
   (<p> ^item-type << location block object >>)
 #  (<p> ^predicates <pred>)
-->
   (<s> ^parameter <p>)
}

sp {convert-parsed-format*elaborate*arg1*parameter*predicate
   (state <s> ^name convert-parsed-format
              ^parameter <p>
              ^clause <c>)
   (<c> ^arg1 <p> ^predicate <pred>)
   (<p> ^item-type << location block object >> ^predicates <ps>)
   (<pred> ^handle <name> ^item-type predicate ^property.handle <prop>)
-->
   (<ps> ^<prop> <name>)
}

sp {convert-parsed-format*elaborate*arg1*relation*parameter
   (state <s> ^name convert-parsed-format
              ^clause <c>)
   (<c> ^<< arg1 arg2 >> <a>)
   (<a> ^2 <p>)
   (<p> ^item-type << location block object >>)
 #  (<p> ^predicates <pred>)
-->
   (<s> ^parameter <p>)
}


sp {convert-parsed-format*elaborate*parameter*relation*parameter
   (state <s> ^name convert-parsed-format
              ^parameter <p>)
   (<p> ^relations <r>)
   (<r> ^2 <pp>)
   (<pp> ^item-type << location block object >>)
-->
   (<s> ^parameter <pp>)
}

sp {convert-parsed-format*elaborate*arg2*parameter
   (state <s> ^name convert-parsed-format
              ^clause <c>)
   (<c> ^predicate.{2} <p>)
   #(<p> ^predicates <pred>)
   (<p> ^item-type << block location object >>)
-->
   (<s> ^parameter <p>)
}

#bias preference for order of mention hack, want real order
sp {prefer*create-object*lower*hanlde*convert-parsed-format
   (state <s> ^name convert-parsed-format
              ^operator <o1> +
              ^operator <o2> +)
   (<o1> ^name create-object ^parameter.handle {<h1> < <h2>})
   (<o2> ^name create-object ^parameter.handle <h2>)
-->
   (<s> ^operator <o1> > <o2>)
}
sp {prefer*create-object*over*handle-clause*convert-parsed-format
   (state <s> ^name convert-parsed-format
              ^operator <o1> +
              ^operator <o2> +)
   (<o1> ^name create-object)
   (<o2> ^name handle-clause)
-->
   (<s> ^operator <o1> > <o2>)
}
sp {prefer*handle-clause*over*complete*convert-parsed-format
   (state <s> ^name convert-parsed-format
              ^operator <o1> +
              ^operator <o2> +)
   (<o2> ^name complete)
   (<o1> ^name handle-clause)
-->
   (<s> ^operator <o1> > <o2>)
}

sp {prefer*create-object*over*handle-clause*convert-parsed-format
   (state <s> ^name convert-parsed-format
              ^operator <o1> +
              ^operator <o2> +)
   (<o1> ^name create-object)
   (<o2> ^name handle-clause)
-->
   (<s> ^operator <o1> > <o2>)
}


sp {convert-parsed-format*propose*create-object
   (state <s> ^name convert-parsed-format
              ^parameter <c>)
   (<c> -^formatted)
-->
   (<s> ^operator <o> + =)
   (<o> ^name create-object
        ^parameter <c>)
}
sp {convert-parsed-format*apply*create-object*increment-object-count
   (state <s> ^name convert-parsed-format
              ^object-count <oc>
              ^operator <o>)
   (<o> ^name create-object ^parameter <c>)
   (<c> -^parameter-index)
-->
   (<c> ^parameter-index <oc>)
   (<s> ^object-count (+ 1 <oc>))
   (<s> ^object-count <oc> -) 
}

sp {create-object*elaborate*parameter
   (state <s> ^name create-object
              ^superstate.operator.parameter <c>)
-->
   (<s> ^parameter <c>)
}

sp {create-object*elaborate*category
   :o-support
   (state <s> ^name create-object
              ^parameter <c>)
   (<c> ^predicates.category {<cat> <> object} -^plural true)
-->
   (<s> ^condition <c1> ^last-condition <c1>)
   (<c1> ^name <cat> ^parameter <p> ^type attribute ^attribute category ^rtype single)
}

sp {create-object*elaborate*cateogy*object
   :o-support
   (state <s> ^name create-object
              ^parameter <c>)
   (<c> ^predicates.category {<cat> << object >>} -^plural true)
-->
   (<s> ^condition <c1> ^last-condition <c1>)
   (<c1> ^name <cat> ^parameter <p> ^type attribute ^attribute primitive ^rtype single)
}

sp {create-object*elaborate*plural
   :o-support
   (state <s> ^name create-object
              ^parameter <c>)
   (<c> ^predicates.category <cat> ^multiple true)
-->
   (<s> ^condition <c1> ^last-condition <c1>)
   (<c1> ^name <cat> ^parameter <p> ^type attribute ^attribute category ^rtype set)
}

sp {create-object*propose*unary-predicate
   (state <s> ^name create-object
             -^condition.name <val>
              ^parameter <c>)
   (<c> ^predicates <p>)
   (<p> ^{<att> <> category <> dialog-object <> handle} <val>)
-->
   (<s> ^operator <o> + =)
   (<o> ^name unary-predicate
        ^attribute <att>
        ^value <val>)
}

sp {create-object*elaborate*condition
   (state <s> ^name create-object
              ^operator <o>
              ^last-condition <cond>
              ^parameter <c>)
   (<cond> ^rtype <rtype>)
   (<o> ^name unary-predicate
        ^attribute {<att> << color size shape >>}
        ^value <val>)
-->
   (<s> ^condition <co>)
   (<co> ^name <val> ^parameter <p> ^type attribute ^attribute <att> ^rtype <rtype> ^args <a>)
   (<a> ^1 <cond>)
   (<s> ^last-condition <cond> -)
   (<s> ^last-condition <co>)
}

sp {create-object*elaborate*condition*learned-predicate
   (state <s> ^name create-object
              ^operator <o>
              ^last-condition <cond>
              ^parameter <c>)
   (<cond> ^rtype <rtype>)
   (<o> ^name unary-predicate
        ^attribute property
        ^value <val>)
-->
   (<s> ^condition <co>)
   (<co> ^name <val> ^parameter <p> ^type concept ^attribute predicate ^rtype <rtype> ^args <a>)
   (<a> ^1 <cond>)
   (<s> ^last-condition <cond> -)
   (<s> ^last-condition <co>)
}
sp {create-object*propose*complete
   (state <s> ^name create-object
              ^parameter <c>)
-->
   (<s> ^operator <o> + <)
   (<o> ^name complete)
}
sp {create-object*apply*complete
   (state <s> ^name create-object
              ^operator.name complete
              ^last-condition <cond>
              ^parameter <c>)
-->
   (<c> ^formatted <cond>)
}
   
   
#problems
#indefinite?
#easy for negation and one usage
#otherwise othello the set is below white blocks)

#####claus
sp {convert-parsed-format*propose*handle-clause*parameter
   (state <s> ^name convert-parsed-format
              ^parameter <p>)
   (<p> ^relations <r>)
   (<r> -^formatted)
-->
   (<s> ^operator <o> + =)
   (<o> ^name handle-clause
        ^parameter <p>)
}

sp {convert-parsed-format*propose*handle-clause
   (state <s> ^name convert-parsed-format
              ^clause <c>)
   (<c> ^arg1 ^predicate <p> -^formatted)
   (<p> ^2)
-->
   (<s> ^operator <o> + =)
   (<o> ^name handle-clause
        ^clause <c>)
}

sp {convert-parsed-format*apply*handle-clause
   (state <s> ^name convert-parsed-format
              ^operator <o>)
   (<o> ^name handle-clause ^clause <c>)
   (<c> ^arg1 <c1> ^predicate <r>)
   (<r> ^handle <name> ^2 <c2> -^3)
   (<c1> ^formatted <p> ^parameter-index <id>)
   (<c2> ^formatted <p2> ^parameter-index <id2>)
   (<p> ^rtype <rtype>)
   (<p2> ^rtype <rtype2>)
-->
   (<c> ^formatted true)
   (<s> ^nlp <n>)
   (<n> ^name <name> ^args <a> ^parameter <para> ^type state-pair ^attribute prepositions ^rtype <rtype>)
   (<a> ^1 <p> ^2 <p2>)
   (<para> ^1 <para1> ^2 <para2>)
   (<para1> ^param-id <id> ^type <rtype>)
   (<para2> ^param-id <id2> ^type <rtype2>)
   
}

sp {convert-parsed-format*apply*handle-clause*parameter
   (state <s> ^name convert-parsed-format
              ^operator <o>)
   (<o> ^name handle-clause ^parameter <c1>)
   (<c1> ^relations <r>)

   (<r> ^handle <name> ^2 <c2> -^3)
   (<c1> ^formatted <p> ^parameter-index <id>)
   (<c2> ^formatted <p2> ^parameter-index <id2>)
   (<p> ^rtype <rtype>)
   (<p2> ^rtype <rtype2>)
-->
   (<r> ^formatted true)
   (<s> ^nlp <n>)
   (<n> ^name <name> ^args <a> ^parameter <para> ^type state-pair ^attribute prepositions ^rtype <rtype>)
   (<a> ^1 <p> ^2 <p2>)
   (<para> ^1 <para1> ^2 <para2>)
   (<para1> ^param-id <id> ^type <rtype>)
   (<para2> ^param-id <id2> ^type <rtype2>)
   
}


#todo
#indifferent handling
#better ordering of param ids
#more concat
#handle negation
#ok if not optimal... with fewer args
#3 argument predicates

#elaborate subclauses
#first version dont order predicates
#first go through and add parameter tags?
#create temp ref to last mentioned nlp that mentions that?
#first bare bones
#then add type, attribute function information lookup smem?


sp {convert-parsed-format*propose*complete
   (state <s> ^name convert-parsed-format)
-->
   (interrupt)
   (<s> ^operator <op> + <)
   (<op> ^name complete)
}

sp {convert-parsed-format*apply*complete
   (state <s> ^name convert-parsed-format
              ^nlp-set <nps>
              ^nlp <nlp>
              ^operator.name complete)
-->
   (<nps> ^nlp <nlp>)
}
#TODO only do when in no known relationships
sp {convert-parsed-format*apply*complete*only-objects
   (state <s> ^name convert-parsed-format
              ^parameter <pp>)
   (<pp> ^formatted <p> ^parameter-index <id>)
   (<p> ^parameter <para>)
-->
   (<s> ^nlp <p>)
   (<para> ^1 <p2>)
   (<p2> ^param-id <id>)
}
sp {convert-parsed-format*apply*complete*superstate*copy
   (state <s> ^name convert-parsed-format
              ^superstate <ss>
              ^nlp-set <nps>
              ^operator.name complete)
 #  (<nps> ^aname <aname>)
   -{(<s> ^nlp <nlp>)
     (<nps> -^nlp <nlp>)}
(<ss> ^<type> <a> ^gtype <type>)
-->
   (<a> ^nlp-set <nps> ^aname wtf)
   (<nps> ^aname wtf)
  #      ^aname <aname>)
}