
sp {anystate*generalize-action*expand*action*elaborate*generalize-argument
   (state <s> ^generalize-action <ga>)
   (<ga> ^source-action.<arg-name> <arg>)
   (<arg> ^arg-type <arg-type>)
-->
   (<s> ^generalize-argument <gen-arg>)
   (<gen-arg> ^arg-type <arg-type>
              ^arg-name <arg-name>
              ^instance <arg>)
   (<ga> ^generalize-argument <gen-arg>)
}

sp {anystate*generalize-action*elaborate*ungeneralized-arg
   (state <s> ^generalize-action <ga>)
   (<ga> ^generalize-argument <gen-arg>)
   (<gen-arg> -^generalized-rep)
-->
   (<ga> ^ungeneralized-arg true)
}

sp {anystate*propose*generalize-action
   (state <s> ^generalize-action <ga>)
   (<ga> -^ungeneralized-arg true
          ^source-action <src>)
-->
   (<s> ^operator <o> + > =)
   (<o> ^name generalize-action)
}

# Create the root structure
sp {anystate*apply*generalize-action*create*generalized-action
   (state <s> ^generalize-action <ga>
              ^operator.name generalize-action)
   (<ga> ^source-action <src>)
   (<src> ^name <op-name>)
-->
   (<ga> ^generalized-action <gen>)
   (<gen> ^op_name <op-name>)
}

# Copy the action handle
sp {anystate*apply*generalize-action*copy*handle
   (state <s> ^generalize-action <ga>
              ^operator.name generalize-action)
   (<ga> ^source-id.handle <handle>
         ^generalized-action <gen>)
-->
   (<gen> ^action-handle <handle>)
}

# Copy the perform flag
sp {anystate*apply*generalize-action*copy*perform
   (state <s> ^generalize-action <ga>
              ^operator.name generalize-action)
   (<ga> ^source-id.perform <perf>
         ^generalized-action <gen-action>)
-->
   (<gen-action> ^perform <perf>)
}

# Copy the arg-status flag onto the argument
sp {anystate*apply*generalize-action*copy*arg-status
   (state <s> ^generalize-action <ga>
              ^operator.name generalize-action)
   (<ga> ^generalize-argument <arg>
         ^source-id.procedural.<arg-name>.arg-status <arg-status>)
   (<arg> ^arg-name <arg-name>
          ^generalized-rep <gen-arg>)
-->
   (<gen-arg> ^arg-status <arg-status>)
}


# Copy the arguments
# ENUMERATE: 1-4 arguments

sp {anystate*apply*generalize-action*copy*1*arguments
   (state <s> ^generalize-action <ga>
              ^operator.name generalize-action)
   (<ga> ^generalized-action <gen>
         ^generalize-argument <arg1>
         -^generalize-argument { <arg2> <> <arg1> })
   (<arg1> ^arg-name <arg1-name> ^generalized-rep <gen-arg1>)
-->
   (<gen> ^<arg1-name> <gen-arg1>)
}

sp {anystate*apply*generalize-action*copy*2*arguments
   (state <s> ^generalize-action <ga>
              ^operator.name generalize-action)
   (<ga> ^generalized-action <gen>
         ^generalize-argument <arg1>
         ^generalize-argument { <arg2> > <arg1>})
         -^generalize-argument { <arg3> <> <arg1> <> <arg2>})
   (<arg1> ^arg-name <arg1-name> ^generalized-rep <gen-arg1>)
   (<arg2> ^arg-name <arg2-name> ^generalized-rep <gen-arg2>)
-->
   (<gen> ^<arg1-name> <gen-arg1>
          ^<arg2-name> <gen-arg2>)
}

sp {anystate*apply*generalize-action*copy*3*arguments
   (state <s> ^generalize-action <ga>
              ^operator.name generalize-action)
   (<ga> ^generalized-action <gen>
         ^generalize-argument <arg1>
         ^generalize-argument { <arg2> > <arg1>})
         ^generalize-argument { <arg3> > <arg2>})
         -^generalize-argument { <arg4> <> <arg1> <> <arg2> <> <arg3>})
   (<arg1> ^arg-name <arg1-name> ^generalized-rep <gen-arg1>)
   (<arg2> ^arg-name <arg2-name> ^generalized-rep <gen-arg2>)
   (<arg3> ^arg-name <arg3-name> ^generalized-rep <gen-arg3>)
-->
   (<gen> ^<arg1-name> <gen-arg1>
          ^<arg2-name> <gen-arg2>
          ^<arg3-name> <gen-arg3>)
}
              
sp {anystate*apply*generalize-action*copy*4*arguments
   (state <s> ^generalize-action <ga>
              ^operator.name generalize-action)
   (<ga> ^generalized-action <gen>
         ^generalize-argument <arg1>
         ^generalize-argument { <arg2> > <arg1>})
         ^generalize-argument { <arg3> > <arg2>})
         ^generalize-argument { <arg4> > <arg3>})
         -^generalize-argument { <arg5> <> <arg1> <> <arg2> <> <arg3> <> <arg4>})
   (<arg1> ^arg-name <arg1-name> ^generalized-rep <gen-arg1>)
   (<arg2> ^arg-name <arg2-name> ^generalized-rep <gen-arg2>)
   (<arg3> ^arg-name <arg3-name> ^generalized-rep <gen-arg3>)
   (<arg4> ^arg-name <arg4-name> ^generalized-rep <gen-arg4>)
-->
   (<gen> ^<arg1-name> <gen-arg1>
          ^<arg2-name> <gen-arg2>
          ^<arg3-name> <gen-arg3>
          ^<arg4-name> <gen-arg4>)
}
