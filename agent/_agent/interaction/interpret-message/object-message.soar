# Rules that handle when an object-message is sent by the user

# Proposal
sp {interpret-message*propose*object-message
   (state <s> ^name interpret-message
              ^instructor-message <msg>)
   (<msg> ^type object-message
         -^processed2)
-->
   (<s> ^operator <o> +)
   (<o> ^name object-message
        ^category communication
        ^message <msg>)
}

# Elaborate useful information from the message to the operator
sp {interpret-message*elaborate*object-message*object
   (state <s> ^name interpret-message
              ^operator <o> +)
   (<o> ^name object-message
        ^message.information.object <obj>)
-->
   (<o> ^object <obj>)
}

sp {interpret-message*elaborate*object-message*relation
   (state <s> ^name interpret-message
              ^operator <o> +)
   (<o> ^name object-message
        ^message.information.relation <rel>)
-->
   (<o> ^relation <rel>)
}

sp {interpret-message*elaborate*object-message*specifier
   (state <s> ^name interpret-message
              ^operator <o> +)
   (<o> ^name object-message
        ^message.information.object.specifier <spec>)
-->
   (<o> ^specifier <spec>)
}

# Mark Processed

sp {interpret-message*apply*object-message*mark*processed1
   (state <s> ^name interpret-message
              ^operator <o>
              ^quiescence t)
   (<o> ^name object-message
        ^message <msg>)
-->
   (<msg> ^processed1 true)
}

sp {interpret-message*apply*object-message*mark*processed2
   (state <s> ^name interpret-message
              ^operator <o>
              ^quiescence t)
   (<o> ^name object-message
        ^message <msg>)
   (<msg> ^processed1 true)
-->
   (<msg> ^processed2 true)
}


###########################################################
#
# this-object-message
#   Teaching message about an object
#   E.g. 'This is a red triangle'
#
###########################################################

# If the specifier is 'this' and there is no relation, 
#   treat it as a this-object-message
sp {interpret-message*apply*object-message*train-on-object
   (state <s> ^name interpret-message
              ^operator <o>)
   (<o> ^name object-message
        ^specifier << this that >>
       -^relation)
-->
   (<s> ^new-segment-info <info>)
   (<info> ^purpose <p>
           ^originator mentor)
   (<p> ^type train-on-object
        ^parameters <params>
        ^satisfaction <sat>)
   (<params> ^indexable <i>)
   (<i> ^type object
        ^lexical.specifier this
        ^index-info.use-interaction true)
   (<sat> ^learning-event.type object)
}

sp {interpret-message*apply*object-message*train-on-object*copy*word
   (state <s> ^name interpret-message
              ^operator <o>
              ^new-segment-info.purpose.parameters <params>)
   (<o> ^name object-message
        ^specifier << this that >>
        ^object.word <word>
       -^relation)
-->
   (<params> ^indexable <i>)
   (<i> ^type word
        ^lexical <word>
        ^index-info.use-interaction true)
}

###########################################################
#
# ask-property-name response
# After the agent asks 'What is blue?'
# E.g. 'Red is a color' or just 'a color'
#
###########################################################

# If the message is in response to a category-of-word question,
#   learn the word2cat mapping
sp {interpret-message*apply*object-message*ask-property-name*response
   (state <s> ^name interpret-message
              ^operator <o>
              ^current-purpose <purp>)
   (<purp> ^type ask-property-name
           ^word <word>)
   (<o> ^name object-message
        ^message <msg>
        ^specifier << none INDEF >>
        ^object.word {<prop-name> <> <word> }
       -^relation)
-->
   (<s> ^new-segment-info <info>)
   (<info> ^purpose <p>
           ^originator mentor)
   (<p> ^type learn-word
        ^parameters <params>
        ^satisfaction <sat>)
   (<params> ^indexable <i>
             ^word <word>)
   (<i> ^type property
        ^lexical <prop-name>
        ^index-info.use-interaction true)
   (<sat> ^learning-event.type word)
}



#############################################################
#
#  which-question response
#  After the agent asks 'which red object?'
#  E.g. 'The rectangle'
#
#############################################################

sp {interpret-message*apply*object-message*which-question-response*copy-word
   (state <s> ^name interpret-message
              ^operator <o>
              ^current-purpose <p>)
   (<o> ^name object-message
        ^specifier << none DEF >>
        ^object.word {<word> <> UNKNOWN}
       -^relation)
   (<p> ^type which-question
        ^target-object.lexical <lex>)
-->
   (<lex> ^word <word>)
}


#
## Result when responding to a which-question with a relation
#sp {apply*object-message*which-question-response*relation
#   (state <s> ^operator <o>)
#   (<o> ^name object-message
#        ^message <msg>
#        ^specifier << none DEF >>
#        ^relation <rel>)
#   (<rel> ^p1.object <obja> ^p2.object <objb> ^word <prep>)
#   (<msg> ^context <context>)
#   (<context> ^cause which-question)
#-->
#   (<msg> ^purpose <p>)
#   (<p> ^type index-object
#        ^parameters <params>
#        ^satisfaction <sat>)
#   (<params> ^relation <rel2>)
#   (<rel2> ^object1 <obja>
#          ^object2 <objb>
#          ^word <prep>)
#        # AM: Changed satisfaction structure
#   (<sat> ^internal-event.type indexing)
#}
