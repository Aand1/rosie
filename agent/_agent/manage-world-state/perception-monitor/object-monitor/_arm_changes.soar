#########################################################
# Change: update-object
#   Occurs when a ^mark-for-copying flag appears on an object-info
#########################################################

sp {top-state*perception-monitor*elaborate*change-info*update-object
   (state <s> ^superstate nil
              ^perception-monitor.change-info <info>)
-->
   (<info> ^change <update-obj>)
   (<update-obj> ^type update-object
                 ^category object
                 ^op-name update-belief-object)
}

sp {top-state*perception-monitor*object-monitor*elaborate*change*update-object
   (state <s> ^superstate nil
              ^perception-monitor <perc-mon>)
   (<perc-mon> ^changes <changes>
               ^object-monitor.object-info <obj-info>)
   (<obj-info> ^mark-for-copying true
               ^perception-obj)
-->
   (<changes> ^change <change>)
   (<change> ^type update-object
             ^object-info <obj-info>)
}

###########################################################################
#
# Change: moved-object
#   If an object's position significantly changes, investigate
#
##########################################################################

sp {top-state*perception-monitor*elaborate*change-info*moved-object
   (state <s> ^superstate nil
              ^perception-monitor.change-info <info>)
-->
   (<info> ^change <moved-object>)
   (<moved-object> ^type moved-object
                   ^category object
                   ^op-name check-for-occlusion)
}

sp {top-state*perception-monitor*object-monitor*elaborate*change*moved-object
   (state <s> ^superstate nil
              ^perception-monitor <perc-mon>)
   (<perc-mon> ^changes <changes>
               ^object-monitor.object-info <obj-info>)
   (<obj-info> ^differences.has-moved true
               ^status.is-occluded false)
-->
   (<changes> ^change <change>)
   (<change> ^type moved-object
             ^object-info <obj-info>)
}

###########################################################################
#
# Change: shrunken-object
#   If an object's volume drastrically lowers, investigate
#
##########################################################################

sp {top-state*perception-monitor*elaborate*change-info*shrunken-object
   (state <s> ^superstate nil
              ^perception-monitor.change-info <info>)
-->
   (<info> ^change <shrunk-obj>)
   (<shrunk-obj> ^type shrunken-object
                 ^category object
                 ^op-name evaluate-shrunken-object)
}

sp {top-state*perception-monitor*object-monitor*elaborate*change*shurnken-object
   (state <s> ^superstate nil
              ^perception-monitor <perc-mon>)
   (<perc-mon> ^changes <changes>
               ^object-monitor.object-info <obj-info>)
   (<obj-info> ^differences.has-shrunk true
               ^status.is-occluded false)
-->
   (<changes> ^change <change>)
   (<change> ^type shrunken-object
             ^object-info <obj-info>)
}

###########################################################################
#
# Change: grown-object
#   If an object's volume drastrically increases, investigate
#
##########################################################################

sp {top-state*perception-monitor*elaborate*change-info*grown-object
   (state <s> ^superstate nil
              ^perception-monitor.change-info <info>)
-->
   (<info> ^change <grown-obj>)
   (<grown-obj> ^type grown-object
                ^category object
                ^op-name evaluate-grown-object)
}

sp {top-state*perception-monitor*object-monitor*elaborate*change*grown-object
   (state <s> ^superstate nil
              ^io.input-link.self.action wait
              ^perception-monitor <perc-mon>)
   (<perc-mon> ^changes <changes>
               ^object-monitor.object-info <obj-info>)
   (<obj-info> ^differences <diffs>)
   (<diffs> ^has-grown true
           -^growth-wait true)
-->
   (<changes> ^change <change>)
   (<change> ^type grown-object
             ^object-info <obj-info>)
}

#############################################################################
# Change: recheck-occlusion
#   Periodically check occluded objects to see if they are still occluded
#############################################################################

sp {top-state*perception-monitor*elaborate*change-info*recheck-occlusion
   (state <s> ^superstate nil
              ^perception-monitor.change-info <info>)
-->
   (<info> ^change <recheck-occlusion>)
   (<recheck-occlusion> ^type recheck-occlusion
                        ^category object
                        ^op-name check-for-occlusion)
}

sp {top-state*perception-monitor*object-monitor*elaborate*change*recheck-occlusion
   (state <s> ^superstate nil
              ^perception-monitor <perc-mon>)
   (<perc-mon> ^changes <changes>
               ^object-monitor.object-info <obj-info>)
   (<obj-info> ^status.occlusion-timer-expired true)
-->
   (<changes> ^change <change>)
   (<change> ^type recheck-occlusion
             ^object-info <obj-info>)
}

#########################################################
# Change: stale-object
#   Occurs when an object on the svs link becomes stale
#########################################################

sp {top-state*perception-monitor*elaborate*change-info*stale-object
   (state <s> ^superstate nil
              ^perception-monitor.change-info <info>)
-->
   (<info> ^change <stale-obj>)
   (<stale-obj> ^type stale-object 
                ^category object
                ^op-name attend-to-stale-object)
}

sp {top-state*perception-monitor*object-monitor*elaborate*change*stale-object
   (state <s> ^superstate nil
              ^perception-monitor <perc-mon>)
   (<perc-mon> ^changes <changes>
               ^object-monitor.object-info <obj-info>)
   (<obj-info> ^status <status>)
   (<status> ^visible false
             ^is-occluded false)
-->
   (<changes> ^change <change>)
   (<change> ^type stale-object
             ^object-info <obj-info>)
}

############################################################################################
# Change: changed-object-predicate
#    When a unary predicate for a given category is different between 
#    belief and perception objects
#############################################################################################

sp {top-state*perception-monitor*elaborate*change-info*changed-object-predicate
   (state <s> ^superstate nil
              ^perception-monitor.change-info <info>)
-->
   (<info> ^change <changed-obj-pred>)
   (<changed-obj-pred> ^type changed-object-predicate
                       ^category object
                       ^op-name attend-to-changed-object-predicate)
}

# Visual properties get copied only when not occluded
sp {top-state*perception-monitor*object-monitor*elaborate*changes*changed-object-predicate*visual
   (state <s> ^top-state <s>
              ^perception-monitor <perc-mon>)
   (<perc-mon> ^changes <changes>
               ^object-monitor.object-info <obj-info>)
   (<obj-info> ^properties.property-info <prop-info>
               ^wm-obj.predicates <wm-preds>
               ^status.is-occluded false)
   (<prop-info> ^property-handle <prop-handle>
                ^type visual
                ^predicate-handle <pred-handle>)
   (<wm-preds> -^<prop-handle> <pred-handle>)
-->
   (<changes> ^change <change>)
   (<change> ^type changed-object-predicate
             ^object-info <obj-info>
             ^property-handle <prop-handle>
             ^predicate-handle <pred-handle>)
}

sp {top-state*perception-monitor*object-monitor*elaborate*changes*changed-object-predicate*non-visual
   (state <s> ^top-state <s>
              ^perception-monitor <perc-mon>)
   (<perc-mon> ^changes <changes>
               ^object-monitor.object-info <obj-info>)
   (<obj-info> ^properties.property-info <prop-info>
               ^wm-obj.predicates <wm-preds>)
   (<prop-info> ^property-handle <prop-handle>
               -^type visual
                ^predicate-handle <pred-handle>)
   (<wm-preds> -^<prop-handle> <pred-handle>)
-->
   (<changes> ^change <change>)
   (<change> ^type changed-object-predicate
             ^object-info <obj-info>
             ^property-handle <prop-handle>
             ^predicate-handle <pred-handle>)
}

sp {top-state*perception-monitor*object-monitor*elaborate*changes*changed-object-predicate*visible*false
   (state <s> ^top-state <s>
              ^perception-monitor <perc-mon>)
   (<perc-mon> ^changes <changes>
               ^object-monitor.object-info <obj-info>)
   (<obj-info> ^status.visible false
               ^wm-obj.predicates <preds>)
   (<preds> ^visible true)
-->
   (<changes> ^change <change>)
   (<change> ^type changed-object-predicate
             ^object-info <obj-info>
             ^property-handle visible
             ^predicate-handle false)
}

sp {top-state*perception-monitor*object-monitor*elaborate*changes*changed-object-predicate*visible*true
   (state <s> ^top-state <s>
              ^perception-monitor <perc-mon>)
   (<perc-mon> ^changes <changes>
               ^object-monitor.object-info <obj-info>)
   (<obj-info> ^status.visible true
               ^wm-obj.predicates <preds>)
   (<preds> ^visible false)
-->
   (<changes> ^change <change>)
   (<change> ^type changed-object-predicate
             ^object-info <obj-info>
             ^property-handle visible
             ^predicate-handle true)
}
