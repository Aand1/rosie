###################################################
#
# position differences
#   compare-position <compare> - svs filter
#   pos-diff <diff> - svs filter result 
#   has-moved true - true if pos-diff > threshold
#
###################################################

sp {top-state*perception-monitor*object-monitor*elaborate*svs-command*compare-position
   (state <s> ^superstate nil
              ^perception-monitor.object-monitor.object-info <obj-info>
              ^svs.command <cmd>)
   (<obj-info> ^perception-obj.id <perc-id>
               ^belief-obj.id <bel-id>
               ^differences <diffs>)
-->
   (<cmd> ^extract <compare>)
   (<compare> ^type distance 
              ^a <a>
              ^b <b>
              ^distance_type centroid)
   (<a> ^type node
        ^id <perc-id>)
   (<b> ^type node
        ^id <bel-id>)
   (<diffs> ^compare-position <compare>)
}

sp {top-state*perception-monitor*object-monitor*object-info*differences*elaborate*pos-diff
   (state <s> ^superstate nil
              ^perception-monitor.object-monitor.object-info.differences <diffs>)
   (<diffs> ^compare-position.result.record.value <val>)
-->
   (<diffs> ^pos-diff <val>)
}

sp {top-state*perception-monitor*object-monitor*object-info*differences*elaborate*has-moved
   (state <s> ^superstate nil
              ^perception-monitor.object-monitor.object-info.differences <diffs>
              ^agent-params.pos-diff-threshold <thresh>)
   (<diffs> ^pos-diff > <thresh>)
-->
   (<diffs> ^has-moved true)
}
